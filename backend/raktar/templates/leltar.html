{% extends 'base.html' %}
{% load static %}

{% block title %}Leltár - Raktárkezelő{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/leltar.css' %}">
{% endblock %}

{% block content %}
<header class="top-header">
    <div class="header-right">
        <span class="user-name"><i class="fas fa-user-circle me-2"></i>{{ user.username }}</span>
        <!--<a href="{% url 'logout' %}" class="btn btn-logout">
            <i class="fas fa-sign-out-alt me-2"></i>Kilépés
        </a> -->
    </div>
</header>

<div class="main-container">
    {% include 'partials/sidebar.html' %}

    <main class="content-area">
        <div id="contentContainer">
            <h2><i class="fas fa-clipboard-list me-3"></i>Leltár</h2>
            
            <div class="toolbar-section">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <button class="btn btn-excel me-2">
                            <i class="fas fa-file-excel me-2"></i>Exportálás Excel-be
                        </button>
                        <button class="btn btn-pdf">
                            <i class="fas fa-file-pdf me-2"></i>Exportálás PDF-be
                        </button>
                    </div>
                    <div class="col-md-6 text-end">
                        <a href="{% url 'raktar:leltar' %}" class="btn btn-refresh">
                            <i class="fas fa-sync-alt me-2"></i>Frissítés
                        </a>
                    </div>
                </div>
            </div>

            <div class="table-section mt-4" id="leltarTable">
                <div class="table-responsive">
                    <table class="table table-hover" id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Alkatrész</th>
                                <th>Alkatrész-csoport</th>
                                <th>Cikkszám</th>
                                <th class="text-end">Mennyiség</th>
                                <th>Mértékegység</th>
                                <th class="text-end">Egységár</th>
                                <th class="text-end">Összár</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for alkatresz in alkatreszek %}
                            <tr>
                                <td>{{ alkatresz.leiras|truncatechars:50 }}</td>
                                <td><span class="csoport-badge">{{ alkatresz.alkatreszcsoport.alkcsop }}</span></td>
                                <td><span class="cikkszam-badge">{{ alkatresz.cikkszam }}</span></td>
                                <td class="text-end">{{ alkatresz.keszlet }}</td>
                                <td>{{ alkatresz.mertekegyseg.mertegys }}</td>
                                <td class="text-end">{{ alkatresz.listaar|floatformat:0 }} Ft</td>
                                <td class="text-end"><strong>{% widthratio alkatresz.keszlet 1 alkatresz.listaar %} Ft</strong></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" class="text-center text-muted py-5">
                                    <i class="fas fa-inbox fa-3x mb-3 d-block"></i>
                                    Nincs megjeleníthető leltár adat.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr class="table-total">
                                <td colspan="3"><strong>ÖSSZESEN:</strong></td>
                                <td class="text-end"><strong id="totalQuantity">{{ total_quantity }}</strong></td>
                                <td></td>
                                <td></td>
                                <td class="text-end"><strong id="totalValue">{{ total_value|floatformat:0 }} Ft</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </main>
</div>

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<script src="{% static 'js/leltar.js' %}"></script>
{% endblock %}
{% endblock %}